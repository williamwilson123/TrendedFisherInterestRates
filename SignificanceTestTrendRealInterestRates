%for interpretation of the linear model, please look at the bottom of the page
%key takeaway is a tStat of -3.25, with 73 degrees of freedom, significant at the 0.1% level
%this is the value for a coefficient of -0.02% fall in real interest rates per annum

%key economic assumptions:
%Fisher equation linking real interest rates, nominal interest rates and inflation expectations
%inflation expectations set via adjustive expectations
%inflation expectation in time period t = inflation realised in time period t-1

%the inflation estimates used were those of Rousseaux, but work done by Heim and Mirowski
%shows that the inflation series used did not affect results "in any crucial way"

%the nominal interest rate data are from the Bank of England archive

%please see the bibliography in the respository for citations

%all code is in MATLAB, making use of the 'statistics and machine learning' toolbox

%setting up variables for the interest rate time series

InterestRatesSince1694 = Interestratechangessince1694{:,"InterestRate"};
InterestDatesString = Interestratechangessince1694{:,"Date"};
InterestRateDates = datetime(InterestDatesString);
yearsofIR = year(InterestRateDates);
ratesandyears = [yearsofIR, InterestRatesSince1694];
meanIRtill1894 = mean(InterestRatesSince1694(1:2400));

%setting up variables for the inflation time series - turning index into an annual inflation rate

InflationIndex = RousseauxPriceIndex{:,:};
inflationrate = nan((height(RousseauxPriceIndex)-1),2);
for c = 1:(height(RousseauxPriceIndex)-1)
inflationrate(c,:) = [InflationIndex(c,1), (((InflationIndex(c+1,2))-(InflationIndex(c,2)))/(InflationIndex(c,2)))];
end

%taking a look at the data to check for errors

twentyavgIR = movmean(InterestRatesSince1694,20);
plot(InterestRateDates,twentyavgIR)
plot(InterestRateDates,InterestRatesSince1694)

%I was considering adding a random noise variable, to account for the over-estimation of data accuracy, but decided
%instead to use a more rigorous hypothesis test
%randomnoise = randn(height(InterestRatesSince1694),1);
%scalednoise = (randomnoise + 4.85)

%putting the variables into the correct format
%taking a yearly mean of the monthly interest rates
%could arguably have just taken the yearly inflation away from monthly interest rates
%to give 12x more data points, but I felt that due to time lags (eg fixed rate contracts) there was an
%inherent smoothing in the monthly interest rate, making the inaccuracy generated by averaging small

tabledIRandyear = table(ratesandyears(:,1),ratesandyears(:,2));
tabledIRandyear.Properties.VariableNames = {'yearofnominalIR','nominalIR'};
yearlyNIR = grpstats(tabledIRandyear,'yearofnominalIR');
nominalIRineachyear = yearlyNIR{:,[1, 3]};

%adaptive expectations model, where inflation expectations are equal to the previous years' inflation
%the exception is the year 1800, where inflation expectation = inflation, due to lack of data point for 1799

inflationexpectation = nan((height(inflationrate)),2);
inflationexpectation(:,1) = inflationrate(:,1);
inflationexpectation(1,2) = inflationrate(1,2);
for q = 2:height(inflationrate)
inflationexpectation(q,2) = inflationrate(q-1,2);
end

%mathching the inflation time series and interest rate time series year to year
%using the Fisher equation to convert nominal interest rates and inflation expectations into real interest rates

correctrangeofnominalIR = nominalIRineachyear((nominalIRineachyear(:,1)>= 1800) & (nominalIRineachyear(:,1)<=1893),:);
fisherrealinterest = [correctrangeofnominalIR(:,1), (correctrangeofnominalIR(:,2)-inflationexpectation(:,2))];

%examining the data, found the real interest rate to be left skewed, unsurprising given
%the trended nature of interest rates from 1649-2013, not a particularly useful
%observation as I view the nominal interest rate in 2013 as of low relevance
%to analysis of the 19th century

plot(fisherrealinterest(:,1),fisherrealinterest(:,2))
histogram(fisherrealinterest(:,2))

%Looking at smoothed versions of the interest rate to more easily identify a trend
%the argument of the essay is that decreasing interest rates over the mid-late 19th century
%impacted growth, so the moving average trend is only taking nominal interest rate values
%for the years beyond 1820
%the 20 year moving average looked like a linear relationship, hence the use of a linear model

twentyavgFIR = movmean(fisherrealinterest(20:end,2),20);
tenavgFIR = movmean(fisherrealinterest(20:end,2),10);
twostagetwentyfisher = nan(94,1);
twostagetwentyfisher(20:94) = twentyavgFIR;
twostagetwentyfisher(1:20) = 5;
twostagetenfisher = nan(94,1);
twostagetenfisher(20:94) = tenavgFIR;
twostagetenfisher(1:20) = 5;
clf
hold on
plot(twostagetenfisher)
plot(twostagetwentyfisher)
plot(fisherrealinterest(:,2))
hold off

%a linear regression model was used to look at the significance of the relationship
%and to see whether the data are indeed sufficient to argue that the interest rate was
%negatively trended over the mid-late 19th century
%the the - 1820 is to adjust the original dates into years from beginning of the model

linearmodel = fitlm((fisherrealinterest(20:end,1)-1820),fisherrealinterest(20:end,2))

%linear model outcome - degrees of freedom 73
%F statistic vs constant model: 10.6 with a p-value of 0.00174
%this shows a 0.17% chance that with a constant mean and standard deviation estimated from the data
%the observed results could have been seen - a 0.17% chance that the deviation from a constant mean
%was due to random chance
%Estimated coefficients - trend intercept: 4.58 tStat: 19.8
%This tStat is massively significant - 
%This intercept is very similar to the value of 4.46 seen in 1822, but overall the intercept
%is not important as the aim is to identify whether there exists a trend or not
%trend gradient: -0.0175 tStat: -3.25
%This gradient shows that the best estimate is that real interest rates fell by 0.02% per year over
%the mid-late 19th century
%The tStat of -3.25 is significant at the 0.1% significance level, clearly showing a downward trend
%R-squared is low, 0.126, but the the aim of the model is not to predict/interpolate interest rates from the year
%it is unsurprising that such a volatile factor as interest rates fluctuates around its trend by large amounts
%the key takeaway is that the overall downward trend is statistically significant, and thus can be used as a potential
%mechanism for GDP growth through the stimulation of increased investment.
